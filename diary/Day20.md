# Day20
自己跟自己打架

## 多人使用遠端儲存庫
一個人使用就是一種遠端備份概念而已，多人使用就會發生許許多多問題，這就是今天的嘗試。

## 建立遠端儲存庫
雖然在自家電腦裡，但在不同資料夾下，內容沒有完全同步的情況都可以算是遠端。而建立一個遠端儲存庫的方法跟知前差不多，就是資料夾跟`git init`，不過這次會弄成這樣。

```
mkdir project.git
cd project.git
git init --bare
```

`--bare`的參數就是建立一個空的repositray來給我麼存取，裡面就是跟local端的`.git`裡面放的東西一樣。

## 創建使用者
首先我們需要創建兩個 ~~(更多也可以，但沒必要)~~ ，分別使用`git clone project.git use1WD`跟`git clone project.git use2WD`，這裡我犯了個小小問題，就是還沒有個初始版本就做`clone`不過它很好心的跳出warning而已，資料夾還是創建了。發現後，我趕緊用use1建立初始版本push上去，再讓use2載下來。

![](https://i.imgur.com/zlmKX0W.png)

上圖中，上為use1，下為use2。

## 嘗試操作
兩人以上共用一定會發生的事情，就是你手上資料不完整，而這不完整的原因在於你下載跟你上傳的時機點有間距，而在這時間差中，其他人更新的遠端版本，導致你的版本落後了。

### use1視角
use1初始化版本後，想到忘了新增一個檔案b.txt，所以趕緊的去新增了b.txt並push"add b.txt"上去。而他不知道這段期間已經有人pull舊版本並開始修改。

![](https://i.imgur.com/TmVzolg.png)

### use2視角
use2得知遠顛被創建了，趕緊去clone一份下來，他看到最新狀態是"init commit"的版本。這時候他認為需要一份c.txt的版本，所以新增"add c.txt"版本上去，但push時發現了錯誤，遠端方告知已經有更新的版本在上面了，你不能直接上傳。use2不知道發生什麼事情，只好用`git fetch`來查看狀況。

![](https://i.imgur.com/61BaZja.png)

一看才發現有人新增了b.txt版本上去，看起來沒有任何衝突，use2就直接用`git merge origin/master`合併了兩個狀態，直接push上去。

![](https://i.imgur.com/uPXurc8.png)

### use1視角
use1看了看第一次上傳的a.txt狀態，想了想覺得不太好，就把a.txt的內容修改了一下，push一份"a.txt is 2"上去，卻發現遠端其實有更新過了，use1發現自己已經commit新版本了，就用`git pull`幫忙merge遠端到現在版本，而merge中沒有出現問題就push回去。

![](https://i.imgur.com/78K1pWE.png)

### use2視角
use2決定要修改一下a.txt的內容，新增了"a.txt is 3"上去。這次他學會了在上船前先用`git pull`合併遠端版本跟現在版本，但出現了問題。他看到a.txt的內容在merge時出現衝突。但是看了看衝突部分，發現舊的狀態似乎更好，決定在衝突地方保留舊的狀態。

![](https://i.imgur.com/q84qtML.png)

之後用`git add .`和`git commit -a`來繼續merge，並新註記了"a.txt is 2"的訊息後push。

![](https://i.imgur.com/HAKjyTN.png)

## 操作過後
後面我還有一連串的操作，但因為要繼續記錄差不多的操作太浪費時間了，就不打算寫下去。

看了下去後，大多問題都在push跟pull上。

- push失敗
  - 就是因為本地沒有時常跟遠端更新，所以才會發生。
  - 預防這問題是防不勝防，只能做到開工前pull一下，但是因為每個人時間安排不同，所以push時間也不同，只能在遇到時在pull一次merge兩個版本了。
- merge失敗
  - 先不管是不是多人，只要你有需求在不同分支上工作，就一定會發生，更何況一個跟你想法不同的人和你一起編輯。
  - 遇到這狀況會很尷尬，畢竟有時候要merge這東西會比創新製作一塊新的功能花費更久的時間，就只有慢慢看來解決它。

而除了手動解決外，如果遇到一些狀況，你發現merge失敗不知道怎麼改，可以先`git reset --hard HEAD`來讓你的狀態回復到你自己操作的狀況，在去想辦法解決 ~~(人的方向)~~ ，或是你對你自己的更新發現過於無用、多餘、重複了，也可以用`git reset --hard ORIG_HEAD`來回復到pull的最新版本。

## 感想
反反覆覆操作兩個指令視窗，腦裡也昏昏沉沉起來。像是在做衝突修改時，一瞬間忘了上面那個是自己修改還是pull到的修改，開了樹狀圖也發現它沒有完全照著時間做上下，會以使用者第一視角來分配一些上下關係，導致上下順序並不完全是時間之類的狀況，看的都有點頭暈了。

體驗了兩個版本衝突後，最後那張被修改的樹狀圖樣子真令人不敢恭維，難怪會需要操作一些修改commit之類的方式，不然樣子真的夠難看明白 ~~(也可能是我領悟不夠吧)~~ 。

![](https://i.imgur.com/ZeXSCAk.png)
